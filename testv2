local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Allowed usernames
local AllowedPlayers = {
    "Jjsjs356", -- YourUsername (swapped)
    "CircularDingus9",    -- Friend1 (swapped)
    "FriendUsername2",
    "FriendUsername3",
}

-- Check if this player is allowed
local function isAllowed()
    for _, name in ipairs(AllowedPlayers) do
        if LocalPlayer.Name == name then
            return true
        end
    end
    return false
end

-- Stop here if not allowed
if not isAllowed() then return end

-- Code below only runs for allowed players
local targetAnimID = "rbxassetid://10468665991"

local player = LocalPlayer
local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
if not humanoid then
    player.CharacterAdded:Wait()
    humanoid = player.Character:WaitForChild("Humanoid")
end

local function onAnimationPlayed(animationTrack)
    if animationTrack.Animation.AnimationId == targetAnimID then
        animationTrack:Stop()

        -- Play short animation
        task.spawn(function()
            local character = player.Character or player.CharacterAdded:Wait()
            local humanoid = character:WaitForChild("Humanoid")
            local AnimAnim = Instance.new("Animation")
            AnimAnim.AnimationId = "rbxassetid://18896127525"
            local Anim = humanoid:LoadAnimation(AnimAnim)
            Anim:Play()
            wait(1)
            Anim:Stop()
        end)

        -- Emit VFX
        task.spawn(function()
            local Character = player.Character or player.CharacterAdded:Wait()
            local RightArm = Character:WaitForChild("Right Arm")
            local effectPaths = {
                game.ReplicatedStorage.Emotes.VFX.VfxMods.Flasher.char["Right Arm"]["2"],
                game.ReplicatedStorage.Emotes.VFX.VfxMods.Flasher.char["Right Arm"]["2"]["1"],
                game.ReplicatedStorage.Emotes.VFX.VfxMods.Flasher.char["Right Arm"]["2"].Emit2,
                game.ReplicatedStorage.Emotes.VFX.VfxMods.Flasher.char["Right Arm"]["1"],
            }
            local clonedEffects = {}
            for _, effect in ipairs(effectPaths) do
                local cloned = effect:Clone()
                cloned.Parent = RightArm
                table.insert(clonedEffects, cloned)
                for _, child in ipairs(cloned:GetDescendants()) do
                    if child:IsA("ParticleEmitter") then
                        child:Emit(1)
                    end
                end
            end
            task.delay(0.5, function()
                for _, c in ipairs(clonedEffects) do
                    c:Destroy()
                end
            end)
        end)

        -- Play MP3 sounds + Black Flash & Impact
        task.spawn(function()
            wait(0.5)
            local function GetGitSound(GithubSnd, SoundName)
                local url = GithubSnd
                if not isfile(SoundName .. ".mp3") then
                    writefile(SoundName .. ".mp3", game:HttpGet(url))
                end
                local sound = Instance.new("Sound")
                sound.SoundId = (getcustomasset or getsynasset)(SoundName .. ".mp3")
                sound.Volume = 4
                sound.Name = SoundName
                sound.Parent = workspace
                return sound
            end

            GetGitSound(
                "https://github.com/NetlessScripter/GOKU/blob/aa4f0bae5a988bd06a16336ed0fa800774f9cfdb/youtube-4oPUNhKEbws%202.mp3?raw=true",
                "youtube-4oPUNhKEbws 2"
            ):Play()

            GetGitSound(
                "https://github.com/NetlessScripter/GOKU/blob/5d740299e985210dbab05420a303694033a57439/copy_F1DBEE86-821F-489F-B43B-26B076105E64%202.mp3?raw=true",
                "F1DBEE86"
            ):Play()

            local hrp = player.Character:WaitForChild("HumanoidRootPart")

            local part1 = Instance.new("Part")
            part1.Size = Vector3.new(1,1,1)
            part1.Anchored = true
            part1.CanCollide = false
            part1.Transparency = 1
            part1.CFrame = hrp.CFrame * CFrame.new(0, 0, -4)
            part1.Parent = workspace

            local blackFlash = game.ReplicatedStorage.Emotes.VFX.VfxMods.Flasher.vfx.BlackFlashFx.Main:Clone()
            blackFlash.Parent = part1
            for _, child in ipairs(blackFlash:GetChildren()) do
                if child:IsA("ParticleEmitter") then
                    child.Enabled = false
                    child:Emit(15)
                end
            end

            local part2 = Instance.new("Part")
            part2.Size = Vector3.new(1,1,1)
            part2.Anchored = true
            part2.CanCollide = false
            part2.Transparency = 1
            part2.CFrame = hrp.CFrame * CFrame.new(0, 0, -16)
            part2.Parent = workspace

            local lastImpact = game.ReplicatedStorage.Emotes.VFX.VfxMods.Flasher.vfx.LastImpactFx.Attachment:Clone()
            lastImpact.Parent = part2
            for _, child in ipairs(lastImpact:GetChildren()) do
                if child:IsA("ParticleEmitter") then
                    child.Enabled = false
                    child:Emit(15)
                end
            end
        end)
    end
end

humanoid.AnimationPlayed:Connect(onAnimationPlayed)

-- Block certain sounds
local blockedSoundIds = {
    ["rbxassetid://10457021115"] = true,
    ["rbxassetid://7556019578"] = true,
    ["rbxassetid://3183222154"] = true,
    ["rbxassetid://10467680476"] = true,
    ["rbxassetid://12396291040"] = true,
    ["rbxassetid://12396291503"] = true,
    ["rbxassetid://4307204452"] = true,
    ["rbxassetid://4307205188"] = true,
    ["rbxassetid://3848076724"] = true,
    ["rbxassetid://7408635465"] = true,
    ["rbxassetid://12285238428"] = true,
}

RunService.Heartbeat:Connect(function()
    local character = LocalPlayer.Character
    if not character then return end

    for _, sound in ipairs(character:GetDescendants()) do
        if sound:IsA("Sound") and sound.IsPlaying and blockedSoundIds[sound.SoundId] then
            sound:Stop()
        end
    end
end)
